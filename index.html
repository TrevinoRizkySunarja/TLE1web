<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AlterNet</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <header class="appbar">
    <div class="brand">
      <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a7 7 0 0 1 7 7v6.5l1.6 2.77a1 1 0 0 1-1.74 1L18 17.5V9a6 6 0 1 0-12 0v8.5l-0.86 1.5a1 1 0 0 1-1.74-1L5 15.5V9a7 7 0 0 1 7-7Z"/></svg>
      <span>AlterNet</span>
    </div>
    <nav class="topnav">
      <a class="btn ghost" href="compose.html">+ Nieuwe post</a>
    </nav>
  </header>

  <main class="page single-col">
    <section class="feed-list" id="feedList">
      <div class="empty big">Nog geen posts. <a href="compose.html">Maak je eerste post</a> ✨</div>
    </section>
  </main>

  <footer class="foot">
    © 2025 AlterNet — feed
  </footer>

  <template id="postCardTpl">
    <article class="post card">
      <header class="post-head">
        <div class="left">
          <img class="avatar" src="" alt="Avatar"/>
          <div class="meta">
            <div class="username"></div>
            <div class="time"></div>
          </div>
        </div>
        <div class="right">
          <span class="pill ai">AutoCorrect</span>
          <a class="icon-btn" href="compose.html" title="Post maken">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19 11H13V5h-2v6H5v2h6v6h2v-6h6z"/></svg>
          </a>
        </div>
      </header>

      <div class="image-wrap">
        <img class="image" src="" alt=""/>
        <div class="badge">Corrected</div>
      </div>

      <div class="caption">
        <p class="text"></p>
        <p class="hashtags"></p>
      </div>

      <div class="toggles">
        <label class="switch">
          <input class="toggle-original" type="checkbox">
          <span>Toon origineel</span>
        </label>
      </div>

      <footer class="actions">
        <button class="icon-btn" aria-label="Like">
          <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12.1 18.55 11 17.5C5.4 12.36 2 9.28 2 6a4 4 0 0 1 7-2.65A4 4 0 0 1 22 6c0 3.28-3.4 6.36-9 11.5l-0.9 1.05Z"/></svg>
        </button>
        <button class="icon-btn" aria-label="Comment">
          <svg viewBox="0 0 24 24"><path fill="currentColor" d="M20 17.17V5H4v12h12.17L20 21M4 3h16a2 2 0 0 1 2 2v18l-4-4H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"/></svg>
        </button>
        <button class="icon-btn" aria-label="Share">
          <svg viewBox="0 0 24 24"><path fill="currentColor" d="M14 9V5l7 7-7 7v-4H3v-6h11Z"/></svg>
        </button>
      </footer>
    </article>
  </template>

  <script>
    // ---------- Storage helpers ----------
    const LS_KEY = 'aiFeedPostsV1';
    const loadPosts = () => {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    };
    const savePosts = (arr) => localStorage.setItem(LS_KEY, JSON.stringify(arr));

    // ---------- Render feed ----------
    const list = document.getElementById('feedList');
    const tpl  = document.getElementById('postCardTpl');

    function timeLabel(ts){
      try {
        const d = new Date(ts);
        return d.toLocaleString();
      } catch { return 'nu'; }
    }

    function render(){
      const posts = loadPosts().sort((a,b)=>b.createdAt - a.createdAt);
      list.innerHTML = '';
      if (!posts.length){
        const emp = document.createElement('div');
        emp.className = 'empty big';
        emp.innerHTML = `Nog geen posts. <a href="compose.html">Maak je eerste post</a> ✨`;
        list.appendChild(emp);
        return;
      }
      for (const p of posts){
        const node = tpl.content.cloneNode(true);

        node.querySelector('.avatar').src =
          `https://ui-avatars.com/api/?name=${encodeURIComponent(p.user||'U')}&background=6a0dad&color=fff`;
        node.querySelector('.username').textContent = p.user || 'user_demo';
        node.querySelector('.time').textContent = timeLabel(p.createdAt);

        const img = node.querySelector('.image');
        if (p.img) { img.src = p.img; img.alt = p.alt || 'Post afbeelding'; }
        else { img.src = 'https://placehold.co/1000x750/1f1f1f/aaaaaa?text=Geen+afbeelding'; img.alt = 'Placeholder'; }

        const textEl = node.querySelector('.text');
        const tagEl  = node.querySelector('.hashtags');
        textEl.textContent = `【Hook】 ${p.hook}\n\n${p.caption}`;
        tagEl.textContent  = (p.hashtags || []).join(' ');

        node.querySelector('.toggle-original').addEventListener('change', (e)=>{
          if (e.target.checked){
            textEl.textContent = p.original || '—';
            tagEl.textContent = '';
            list.querySelector('.badge')?.classList.add('neutral');
            list.querySelector('.badge')?.classList.remove('ok');
          } else {
            textEl.textContent = `【Hook】 ${p.hook}\n\n${p.caption}`;
            tagEl.textContent  = (p.hashtags || []).join(' ');
          }
        });

        list.appendChild(node);
      }
    }

    render(); // on load
  </script>
</body>
</html>
